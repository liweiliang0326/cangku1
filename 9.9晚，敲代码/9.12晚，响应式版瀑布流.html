<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>9.12晚，响应式版瀑布流</title>
		<link rel="stylesheet" type="text/css" href="css/reset.css"/>
		<style type="text/css">
			ul{
				position: relative;
				margin: 0 auto;
			}
			li{
				width: 200px;
				margin-right: 10px;
				/*background-color: cyan;*/
				font-size: 50px;
				text-align: center;
				position: absolute;
				transition: all 3s;
			}
		</style>
	</head>
	<body>
		<ul id="wrap">
			<!--<li></li>-->
		</ul>
	</body>
	<script type="text/javascript">
		var wrap = document.querySelector("ul");
		var bodyEl = document.getElementsByTagName("body")[0];
		
		//规定列宽列间距
		var listWidth = 200;
		var listRP = 10;
		
		//计算有多少列
		var cols = getCols();
		
		//保存已创建的li
		var lis = new Array();
		
		//保存对应的li高度
		var liHeights = new Array();
		
		//是否第一次创建
		var first = true;
		
		//随机数函数
		function randFn(min,max){
			return parseInt(Math.random() * (max - min) + min);
		}
		
		//得到列数
		function getCols(){
			return parseInt(bodyEl.clientWidth / listWidth);
		}
		
		//开始布局
		function setPos(){
			//这个数组用来存储每一列的高度
			var colsHeightArr = new Array();
			for(var i = 0;i < cols; i++){
				colsHeightArr.push(0);
			}
			//创建20个li
			for(var i = 0; i < 20; i++){
				createLi(i + 1);
			}
			first = false;
			//创建li
			function createLi(index){
				var li = lis[index - 1] || document.createElement("li");
				li.innerHTML = index;
				var h = liHeights[index - 1] || randFn(100,300);
				li.style.height = h + 'px';
				lis[index - 1] = li;
				liHeights[index - 1] = h;
				//设置随机背景色
				var red = randFn(0,255);
				var green = randFn(0,255);
				var blue = randFn(0,255);
				var alphe = Math.random(0,1);
				var str = "rgba(" + red + "," + green + "," + blue + "," + alphe + ")";
				li.style.backgroundColor = str;
				//判断当前几列哪列高度最小
				var minHeight = colsHeightArr[0];
				var minIndex = 0;
				for(var i =1; i < colsHeightArr.length; i++){
					if(minHeight > colsHeightArr[i]){
						minHeight = colsHeightArr[i];
						minIndex = i;
					}
				}
				//将li放到对应的minIndex列
				li.style.left = (listWidth + listRP) * minIndex + 'px';
				li.style.top = colsHeightArr[minIndex] + 'px';
				//修改对应minIndex列的高度
				colsHeightArr[minIndex] += (h + listRP);
				if(first){
					wrap.appendChild(li);
				}
			}
		}
		setPos();
		//检测window也就是窗口大小的变化
		window.onresize = function(){
			//1.得到新的列数与旧的进行对比
			var newCols = getCols();
			if(newCols != cols){
				cols = newCols;
				//计算ul 的宽度
				wrap.style.width = (listWidth + listRP) * cols + 'px';
				setPos();
			}
		}
	</script>
</html>











